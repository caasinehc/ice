<!DOCTYPE html>
<html>
	<head>
		<title>ice.js</title>
		<style>
			body {
				font-family: "Verdana";
			}
		</style>
	</head>
	<body>
		<h1>ice.js</h1>
		<p>A Multi-purpose Javascript library written by and for me, Isaac.</p>
		<p>Here's a convenient tool to help you use ice.js!</p>

		<form id="importTool">
			<fieldset onclick="updateModules();">
				<legend>Modules to include: </legend>
				<label>
					<input type="radio" name="importAll" value="all" onclick="setSpecify(false);" id="importAll" checked />
					All modules<br />
				</label>
				<label>
					<input type="radio" name="importAll" value="specify" onclick="setSpecify(true);" />
					Specify:
				</label>

				<ul id="moduleList" style="list-style: none; margin: 0px;">
					<li>
						<label>
							<input type="checkbox" id="allCB" onclick="toggleEverything();" disabled />
							Select all
						</label>
					</li>
				</ul>
			</fieldset>
		</form>

		<label>
			HTML embed:<br />
			<textarea id="embedInput" rows="10" cols="80"></textarea>
		</label><br />

		<a id="bookmarklet">Import ice.js</a><br />

		<label>
			Javascript import:<br />
			<textarea id="jsInput" rows="10" cols="80"></textarea>
		</label><br />

		<script>
			let modules = {
				math: "math",
				physics: "physics",
				colors: "colors",
				debug: "debug",
				graphics: "graphics",
				dom: "dom",
				time: "time",
				audio: "audio"
			}

			let moduleList = document.getElementById("moduleList");
			for(let module in modules) {
				let li = document.createElement("li");
				let label = document.createElement("label");
				let input = document.createElement("input");
				let labelText = document.createTextNode(modules[module]);
				input.type = "checkbox";
				input.disabled = true;
				label.appendChild(input);
				label.appendChild(labelText);
				li.appendChild(label);
				modules[module] = input;
				moduleList.appendChild(modules[module].parentElement.parentElement);
			}

			let allCB = document.getElementById("allCB");
			let importAll = document.getElementById("importAll");
			let embedInput = document.getElementById("embedInput");
			let bookmarklet = document.getElementById("bookmarklet");
			let jsInput = document.getElementById("jsInput");

			function toggleEverything() {
				for(let module in modules) {
					modules[module].checked = allCB.checked;
				}
			}
			function updateModules() {
				let allChecked = true;
				for(let module in modules) {
					if(!modules[module].checked) {
						allChecked = false;
						break;
					}
				}
				allCB.checked = allChecked;
				updateOutput();
			}
			function setSpecify(enabled) {
				allCB.disabled = !enabled;
				for(let module in modules) {
					modules[module].disabled = !enabled;
				}
			}
			function updateOutput() {
				let toInclude = [];
				if(!importAll.checked) {
					for(let module in modules) {
						if(modules[module].checked) {
							toInclude.push(module);
						}
					}
					updateEmbed(toInclude, false);
					updateBookmarklet(toInclude, false);
					updateJsInclude(toInclude, false);
				}
				else {
					updateEmbed(toInclude, true);
					updateBookmarklet(toInclude, true);
					updateJsInclude(toInclude, true);
				}
			}
			function updateEmbed(toInclude, all) {
				let text = "";
				if(all) {
					text += "<script src=\"https://caasinehc.github.io/ice/src/ice.js\"><\/script>\n"
				}
				else {
					for(let module of toInclude) {
						text += "<script src=\"https://caasinehc.github.io/ice/src/ice." + module + ".js\"><\/script>\n";
					}
				}
				embedInput.innerText = text;
			}
			embedInput.onclick = function() {
				embedInput.select();
			}
			function updateBookmarklet(toInclude, all) {
				let text = all ? (
					`javascript:(d=>{if(d.head===null){if(d.documentElement===null)d.appendChild(d.createElement("html"));d.documentElement.appendChild(d.createElement("head"))}let v=d.createElement("div");let s=d.createElement("script");s.src="https://caasinehc.github.io/ice/src/ice.js";v.appendChild(s);let c=d.currentScript;c?c.parentElement.replaceChild(v,c):d.head.appendChild(v)})(document);`
				) : toInclude.length === 0 ? "javascript: void(0);" : (
					`javascript:(d=>{if(d.head===null){if(d.documentElement===null)d.appendChild(d.createElement("html"));d.documentElement.appendChild(d.createElement("head"))}let v=d.createElement("div");for(let m of["${toInclude.map(str=>str.replace(/src\/ice\.(.*)\.js/, "$1")).join(`","`)}"]){let s=d.createElement("script");s.src=\`https://caasinehc.github.io/ice/src/ice.\${m}.js\`;v.appendChild(s)}let c=d.currentScript;c?c.parentElement.replaceChild(v,c):d.head.appendChild(v)})(document);`
				);
				bookmarklet.href = text;
			}
			function updateJsInclude(toInclude, all) {
				let text = all ? (
`(function() {
	if(document.head === null) {
		if(document.documentElement === null) {
			document.appendChild(document.createElement("html"));
		}
		document.documentElement.appendChild(document.createElement("head"));
	}
	let div = document.createElement("div");
	let script = document.createElement("script");
	script.src = "https://caasinehc.github.io/ice/src/ice.js";
	div.appendChild(script);
	let currentScript = document.currentScript;
	if(currentScript) currentScript.parentElement.replaceChild(div, currentScript);
	else document.head.appendChild(div);
})();`
				) : toInclude.length === 0 ? "" : (
`(function() {
	if(document.head === null) {
		if(document.documentElement === null) {
			document.appendChild(document.createElement("html"));
		}
		document.documentElement.appendChild(document.createElement("head"));
	}
	let modules = ["${toInclude.join(`", "`)}"];
	let div = document.createElement("div");
	for(let module of modules) {
		let script = document.createElement("script");
		script.src = \`https://caasinehc.github.io/ice/src/ice.\${module}.js\`;
		div.appendChild(script);
	}
	let currentScript = document.currentScript;
	if(currentScript) currentScript.parentElement.replaceChild(div, currentScript);
	else document.head.appendChild(div);
})();`
				);
				jsInput.innerText = text;
			}
			jsInput.onclick = function() {
				this.select();
			}

			window.onload = function() {
				updateOutput();
			}
		</script>

	</body>
</html>
